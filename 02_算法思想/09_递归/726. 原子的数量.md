/*
 * Copyright (c) Huawei Technologies Co., Ltd. 2020-2020. All rights reserved.
 */

package leetcode;

import com.sun.org.apache.bcel.internal.generic.ARETURN;

import java.util.Map;
import java.util.TreeMap;

/*
* 方法一：递归
算法：

(1) 编写一个方法 parse 来解析化学式，返回一个由原子名称映射到原子个数的哈希表 count。
(2) 将把 i 设为全局变量：在调用 parse 函数中递增 i。
(3) 当遇到 '('，则解析括号内的内容（直到括号结束），并将其添加到计数中。
(4) 否则，则应该遇到一个大写字符：我们将解析其余的字母以获得名称，并在哈希表中添加该字符（若表中存在则增加计数）。
(5) 最终，我们将乘以括号系数以得到最终结果。

* */

```java
public class CountOfAtoms {
    int i;
    public String countOfAtoms(String formula) {
        StringBuilder ans = new StringBuilder();
        i = 0;
        Map<String, Integer> count = parse(formula);   //使用parse方法解析化学式，返回由原子名映射到原子个数的哈希表count
        for (String name : count.keySet()) {   //获取map集合中所有的键值的set集合
            ans.append(name);    //将键值的集合name追加到ans中
            int multiplicity = count.get(name);
            if (multiplicity > 1) ans.append("" + multiplicity);
        }
        return new String(ans);
    }
    public Map<String,Integer> parse(String formula){
        int N=formula.length();
        Map<String, Integer> count = new TreeMap();
        while (i<N && formula.charAt(i) !=')'){
            if(formula.charAt(i)=='('){
                i++;
                for (Map.Entry<String, Integer> entry: parse(formula).entrySet()) {
                    count.put(entry.getKey(), count.getOrDefault(entry.getKey(), 0) + entry.getValue());
                }
            }else{
                int iStart=i++;
                while (i<N && Character.isLowerCase(formula.charAt(i)))i++;
                String name = formula.substring(iStart,i);
                iStart = i;
                while (i<N && Character.isDigit(formula.charAt(i))) i++;
                int multiplicity = iStart < i?Integer.parseInt(formula.substring(iStart,i)) : 1;
                count.put(name,count.getOrDefault(name,0) + multiplicity);
            }
        } int iStart = ++i;
        while (i < N && Character.isDigit(formula.charAt(i))) i++;
        if (iStart < i) {
            int multiplicity = Integer.parseInt(formula.substring(iStart, i));
            for (String key: count.keySet()) {
                count.put(key, count.get(key) * multiplicity);
            }
        }
        return count;
    }
}
```
